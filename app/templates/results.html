{% extends "base.html" %}

{% block content %}

    <div class="container">

        <div class="container-fluid text-center page-header">
            <h1>Results</h1>
            <p class="lead">Results of your query.</p>
        </div>

    {# Messages #}
        <div class="container">
            <div class="row">
                <div class="col-sm-12">
                    {% with messages = get_flashed_messages() %}
                        {% if messages %}
                            <div class="alert alert-danger alert-dismissable">
                                <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                                <ul class="flashes"></ul>
                                {% for message in messages %}
                                    <li>{{ message }}</li>
                                {% endfor %}
                            </div>
                        {% endif %}
                    {% endwith %}
                </div>
            </div>
        </div>

        <div class="container-fluid">
        <div class="row">

            <div class="col-sm-12">

            <h2>Table view</h2>

                <table class="table table-hover">

                    <thead>
                        <tr>
                            <th scope="col">Variant</th>
                            <th scope="col">dbSNP ID</th>
                            <th scope="col">Chromosome</th>
                            <th scope="col">Ensembl Gene ID</th>
                            <th scope="col">Gene Name</th>
                            <th scope="col">Disease ID</th>
                            <th scope="col">Disease</th>
                            <th scope="col">Phenotype</th>
                            <th scope="col">Phenotype ID</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in final_df.itertuples() %}
                            <tr class="bg-warning">
                                <td>{{ row.variant }}</td>
                                <td>
                                    <a href="https://www.ncbi.nlm.nih.gov/snp/{{ row.variation }}" title="dbSNP" target="_blank">{{ row.variation }}</a>
                                </td>
                                <td>{{ row.chromosome }}</td>
                                <td>{{ row.ensembl_gene_id }}</td>
                                <td>{{ row.gene_name }}</td>
                                <td>
                                    {% if row.disease_id.startswith("OMIM:") %}
                                        {% set disease_num = row.disease_id.strip("OMIM:") %}
                                        <a href="https://www.omim.org/entry/{{ disease_num }}" title="OMIM" target="_blank">{{ row.disease_id }}</a>
                                    {% elif row.disease_id.startswith("ORPHA:") %}
                                        {% set disease_num = row.disease_id.strip("ORPHA:") %}
{#                                          TODO: find a proper url for Orphanet pages  #}
                                        {{ row.disease_id }}
                                    {% else %}
                                        {{ row.disease_id }}
                                    {% endif %}
                                </td>
                                <td>{{ row.disease }}</td>
                                <td>{{ row.phenotype_name }}</td>
                                <td>
                                    {% if row.phenotype_id.startswith("HP:") %}
                                        {% set phenotype_num = row.phenotype_id.replace(":", "_") %}
                                        <a href="http://purl.obolibrary.org/obo/{{ phenotype_num }}" title="HPO" target="_blank">{{ row.phenotype_id }}</a>
                                    {% elif row.phenotype_id.startswith("EFO:") %}
                                        {% set phenotype_num = row.phenotype_id.replace(":", "_") %}
                                        <a href="http://www.ebi.ac.uk/efo/{{ phenotype_num }}" title="EFO" target="_blank">{{ row.phenotype_id }}</a>
                                    {% else %}
                                        {{ row.phenotype_id }}
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>

                </table>

            </div>

        </div>
        </div>

        <div class="container-fluid">
        <div class="row">

            <h2>Network view</h2>

            <div id="mynetwork" style="min-height: 800px; border: 2px solid #F9CF45; border-radius: 10px;" class="bg-warning"></div>

        </div>
        </div>

    </div>

    {{ super() }}

    {% block scripts %}

        <script type="text/javascript">
            // create an array with nodes
            {#var nodes = new vis.DataSet([#}
            {#    {id: 1, label: 'Node 1'},#}
            {#    {id: 2, label: 'Node 2'},#}
            {#    {id: 3, label: 'Node 3'},#}
            {#    {id: 4, label: 'Node 4'},#}
            {#    {id: 5, label: 'Node 5'}#}
            {#]);#}

            var nodes = new vis.DataSet([
                {id: 1, label: 'MT-ND1', color: 'cyan'},
                {id: 2, label: 'T3308A', color: 'yellow'},
                {id: 3, label: 'SUDDEN INFANT DEATH SYNDROME', color: 'red'},
                {id: 4, label: 'colorectal adenocarcinoma', color: 'orange'},
                {id: 5, label: 'colon carcinoma', color: 'orange'},
                {id: 6, label: 'Carcinoma of colon', color: 'red'},
                {id: 7, label: 'Apneic episodes in infancy', color: 'orange'},
                {id: 8, label: 'sudden death', color: 'orange'}
            ]);

            var edges = new vis.DataSet([
                {from: 2, to: 1},
                {from: 2, to: 6},
                {from: 2, to: 3},
                {from: 6, to: 4},
                {from: 6, to: 5},
                {from: 3, to: 8},
                {from: 3, to: 7}
            ]);

            // create an array with edges
            {#var edges = new vis.DataSet([#}
            {#    {from: 1, to: 3},#}
            {#    {from: 1, to: 2},#}
            {#    {from: 2, to: 4},#}
            {#    {from: 2, to: 5}#}
            {#]);#}

            // create a network
            var container = document.getElementById('mynetwork');

            // provide the data in the vis format
            var data = {
                nodes: nodes,
                edges: edges
            };
            var options = {height: '800px'};

            // initialize your network!
            var network = new vis.Network(container, data, options);
        </script>

    {% endblock %}

{% endblock %}