{% extends "base.html" %}

{% block content %}

    <div class="container">

        <div class="container-fluid text-center page-header">
            <h1>Results</h1>
            <p class="lead">Results of your query.</p>
        </div>

    {# Messages #}
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-12">
                    {% with messages = get_flashed_messages() %}
                        {% if messages %}
                            <div class="alert alert-danger alert-dismissable">
                                <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                                <ul class="flashes"></ul>
                                {% for message in messages %}
                                    <li>{{ message }}</li>
                                {% endfor %}
                            </div>
                        {% endif %}
                    {% endwith %}
                </div>
            </div>
        </div>

    {% if json_data != "'{}'" %}

        <div class="container-fluid">
        <div class="row">

            <h2>Network view</h2>

            <div class="col-sm-12 alert alert-warning alert-dismissable">
                <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                <p>Creating large networks may require a few seconds or minutes, please be patient while the network is being built.</p>
            </div>

            <br><br><br>

            <div id="networkview"></div>

        </div>
        </div>

        <br>

        {# Legend #}
        <div class="container-fluid">
        <div class="row">

            <div class="col-sm-2">&nbsp;</div>

            <div class="col-sm-2 text-center" style="background-color: #F9CF45; border: 2px solid #CCAA39;">
                <strong>Variants</strong>
            </div>

            <div class="col-sm-2 text-center" style="background-color: #739E82; border: 2px solid #5F826B;">
                <strong>Genes</strong>
            </div>

            <div class="col-sm-2 text-center" style="background-color: #D7816A; border: 2px solid #B06A57;">
                <strong>Diseases</strong>
            </div>

            <div class="col-sm-2 text-center" style="background-color: #93B5C6; border: 2px solid #7995A3;">
                <strong>Phenotypes</strong>
            </div>

            <div class="col-sm-2">&nbsp;</div>

        </div>
        </div>

        <div class="container-fluid">
        <div class="row">
            <h2>Table view</h2>

            <div class="col-sm-12">

                <ul class="nav nav-tabs">
                    <li class="active"><a data-toggle="tab" href="#variants">Variants</a></li>
                    <li><a data-toggle="tab" href="#genes">Genes</a></li>
                    <li><a data-toggle="tab" href="#diseases">Diseases</a></li>
                    <li><a data-toggle="tab" href="#phenotypes">Phenotypes</a></li>
                </ul>

                <br>

                <div class="tab-content">
                    <!-- Variants -->
                    <div id="variants" class="tab-pane fade in active">
                        <table class="table table-hover res_table" style="background-color: #F9CF45;">
                            <thead>
                                <tr>
                                    <th scope="col">Variant</th>
                                    <th scope="col">Gene</th>
                                </tr>
                            </thead>
                            <tbody>
                            {% if variants|length > 0 %}
                                {% for el in variants %}
                                    <tr>
                                        <td><a href="https://www.ncbi.nlm.nih.gov/snp/{{ el[1] }}" title="dbSNP" target="_blank">{{ el[0] }}</a></td>
                                        <td>{{ el[2] }}</td>
                                    </tr>
                                {% endfor %}
                            {% endif %}
                            </tbody>
                        </table>
                    </div>
                    <!-- Genes -->
                    <div id="genes" class="tab-pane fade in">
                        <table class="table table-hover res_table" style="background-color: #739E82;">
                            <thead>
                                <tr>
                                    <th scope="col">Gene</th>
                                </tr>
                            </thead>
                            <tbody>
                            {% if genes|length > 0 %}
                                {% for el in genes %}
                                    <tr>
                                    {% if el[1].startswith("LRG") %}
                                        <td><a href="http://ftp.ebi.ac.uk/pub/databases/lrgex/{{ el[1] }}.xml" title="Gene" target="_blank">{{ el[0] }}</a></td>
                                    {% else %}
                                        <td><a href="https://www.ensembl.org/id/{{ el[1] }}" title="Gene" target="_blank">{{ el[0] }}</a></td>
                                    {% endif %}
                                    </tr>
                                {% endfor %}
                            {% endif %}
                            </tbody>
                        </table>
                    </div>
                    <!-- Diseases -->
                    <div id="diseases" class="tab-pane fade in">
                        <table class="table table-hover res_table" style="background-color: #D7816A;">
                            <thead>
                                <tr>
                                    <th scope="col">Disease Name</th>
                                </tr>
                            </thead>
                            <tbody>
                            {% if diseases|length > 0 %}
                                {% for el in diseases %}
                                    <tr>
                                        <td><a href="http://linkedlifedata.com/resource/umls/id/{{ el[1] }}" title="UMLS" target="_blank">{{ el[0] }}</a></td>
                                    </tr>
                                {% endfor %}
                            {% endif %}
                            </tbody>
                        </table>
                    </div>
                    <!-- Phenotypes -->
                    <div id="phenotypes" class="tab-pane fade in">
                        <table class="table table-hover res_table" style="background-color: #93B5C6;">
                            <thead>
                                <tr>
                                    <th scope="col">Phenotype Name</th>
                                </tr>
                            </thead>
                            <tbody>
                            {% if phenotypes|length > 0 %}
                                {% for el in phenotypes %}
                                    <tr>
                                    {% if el[1].startswith("HP:") %}
                                        <td><a href="https://hpo.jax.org/app/browse/term/{{ el[1] }}" title="HPO" target="_blank">{{ el[0] }}</a></td>
                                    {% endif %}
                                    </tr>
                                {% endfor %}
                            {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>
        </div>

        <div class="container-fluid">
        <div class="row">

            <h2>Data view</h2>

            <div class="col-sm-12">
                <pre style="max-height: 300px;">{{ json_data }}</pre>
            </div>

{#            <div class="col-sm-12">#}
{##}
{#            <h2>Table view</h2>#}
{##}
{#                <table class="table table-hover" id="res_table">#}
{##}
{#                    <thead>#}
{#                        <tr>#}
{#                            <th scope="col">Variant</th>#}
{#                            <th scope="col">dbSNP ID</th>#}
{#                            <th scope="col">Chromosome</th>#}
{#                            <th scope="col">Ensembl Gene ID</th>#}
{#                            <th scope="col">Gene Name</th>#}
{#                            <th scope="col">Disease</th>#}
{#                            <th scope="col">Disease ID</th>#}
{#                            <th scope="col">Phenotype</th>#}
{#                            <th scope="col">Phenotype ID</th>#}
{#                        </tr>#}
{#                    </thead>#}
{#                    <tbody>#}
{#                        {% for row in final_df.itertuples() %}#}
{#                            <tr class="bg-warning">#}
{#                                <td>{{ row.variant }}</td>#}
{#                                <td>#}
{#                                    <a href="https://www.ncbi.nlm.nih.gov/snp/{{ row.variation }}" title="dbSNP" target="_blank">{{ row.variation }}</a>#}
{#                                </td>#}
{#                                <td>{{ row.chromosome }}</td>#}
{#                                <td>{{ row.ensembl_gene_id }}</td>#}
{#                                <td>{{ row.gene_name }}</td>#}
{#                                <td>{{ row.disease }}</td>#}
{#                                <td>#}
{#                                    {% if row.disease_id.startswith("OMIM:") %}#}
{#                                        {% set disease_num = row.disease_id.strip("OMIM:") %}#}
{#                                        <a href="https://www.omim.org/entry/{{ disease_num }}" title="OMIM" target="_blank">{{ row.disease_id }}</a>#}
{#                                    {% elif row.disease_id.startswith("ORPHA:") %}#}
{#                                        {% set disease_num = row.disease_id.strip("ORPHA:") %}#}
{#                                        <a href="http://www.orpha.net/ORDO/Orphanet_{{ disease_num }}" title="Orphanet" target="_blank">{{ row.disease_id }}</a>#}
{#                                    {% else %}#}
{#                                        {{ row.disease_id }}#}
{#                                    {% endif %}#}
{#                                </td>#}
{#                                <td>{{ row.phenotype_name }}</td>#}
{#                                <td>#}
{#                                    {% if row.phenotype_id.startswith("HP:") %}#}
{#                                        {% set phenotype_num = row.phenotype_id.replace(":", "_") %}#}
{#                                        <a href="http://purl.obolibrary.org/obo/{{ phenotype_num }}" title="HPO" target="_blank">{{ row.phenotype_id }}</a>#}
{#                                    {% elif row.phenotype_id.startswith("EFO:") %}#}
{#                                        {% set phenotype_num = row.phenotype_id.replace(":", "_") %}#}
{#                                        <a href="http://www.ebi.ac.uk/efo/{{ phenotype_num }}" title="EFO" target="_blank">{{ row.phenotype_id }}</a>#}
{#                                    {% elif row.phenotype_id.startswith("Orphanet:") %}#}
{#                                        {% set phenotype_num = row.phenotype_id.replace(":", "_") %}#}
{#                                        <a href="http://www.orpha.net/ORDO/{{ phenotype_num }}" title="Orphanet" target="_blank">{{ row.phenotype_id }}</a>#}
{#                                    {% else %}#}
{#                                        {{ row.phenotype_id }}#}
{#                                    {% endif %}#}
{#                                </td>#}
{#                            </tr>#}
{#                        {% endfor %}#}
{#                    </tbody>#}
{##}
{#                </table>#}
{##}
{#            </div>#}

        </div>
        </div>

    {% else %}
        <br>
    {% endif %}

    </div>

    {{ super() }}

    {% block scripts %}

        {{ super() }}

        {% autoescape false %}
        <script type="text/javascript">
            var nodes = new vis.DataSet([
                {% for node in nodes %}
                    {id: {{ node["id"] }}, label: '{{ node["label"] }}',
                    color: { background: '{{ node["color"]["background"] }}',
                             border: '{{ node["color"]["border"] }}' } },
                {% endfor %}
            ]);
            var edges = new vis.DataSet([
                {% for edge in edges %}
                    {from: {{ edge["from"] }}, to: {{ edge["to"] }} },
                {% endfor %}
            ]);

            // create a network
            var container = document.getElementById('networkview');

            // provide the data in the vis format
            var data = {
                nodes: nodes,
                edges: edges
            };
            var options = {height: '800px', borderWidth: 3};

            // initialize your network!
            var network = new vis.Network(container, data, options);
        </script>
        {% endautoescape %}

        <script type="text/javascript">
            $(document).ready( function () {
                $('.res_table').DataTable();
            } );
        </script>

    {% endblock %}

{% endblock %}